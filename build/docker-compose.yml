version: "3.0"
services:
  nlu:
    build: ./docker/nlu/
    image: mcleonte/zaida-nlu
    container_name: zaida-nlu
    user: 1000:1000
    ports:
      - 5005:5005
    volumes:
      - ./docker/nlu:/app
    command:
      - run
    environment:
      - SQLALCHEMY_SILENCE_UBER_WARNING=1

  nlu-actions:
    build: ./docker/nlu-actions/
    image: mcleonte/zaida-nlu-actions
    container_name: zaida-nlu-actions
    expose:
      - 5055
    volumes:
      - ./docker/nlu-actions:/app/actions
      - /etc/localtime:/etc/localtime
    environment:
      - LOG_LEVEL=DEBUG

  stt:
    build: ./docker/stt/
    image: mcleonte/zaida-stt
    container_name: zaida-stt
    ports:
      - 8765:8765
    volumes:
      - ./docker/stt/:/app/
    environment:
      - PORT=8765
      - LOG_LEVEL=DEBUG
      - MODEL_PATH=/app/models
      - MODEL_NAME=small.en
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
              count: 1

  tts:
    build:
      context: ./docker/tts
      dockerfile: Dockerfile.gpu
    image: mcleonte/zaida-tts
    container_name: zaida-tts
    ports:
      - 59125:59125
    volumes:
      - ./docker/tts/voices/:/home/mimic3/.local/share/mycroft/mimic3/voices/
    command: --preload-voice en_US/vctk_low --voice en_US/vctk_low#p329
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
              count: 1
